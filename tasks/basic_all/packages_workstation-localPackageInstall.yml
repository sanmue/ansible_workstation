# ----------------------------------------
# Install from locally downloades packages
# ----------------------------------------

# #####################################
# ### Citrix Workspace App (ICA-Client)
# #####################################

- name: Local packages install - install Certificates for Citrix Workspace App (ICA-Client) from Mozilla cert-folder + pem-convert (Ubuntu)
  # requires installed Mozilla Firefox (was installed via a previous task)
  ansible.builtin.shell:
    # chdir: tasks/basic_all/
    # cmd: ./config_workstation-localPackageInstall-CitrixWorkspaceApp.sh
    cmd: chmod +x ./tasks/basic_all/config_workstation-localPackageInstall-CitrixWorkspaceApp.sh && ./tasks/basic_all/config_workstation-localPackageInstall-CitrixWorkspaceApp.sh
  when:
    - ansible_distribution == "Ubuntu"

- name: TODO - Download and install Citrix Workspace App + USB Support Package (Ubuntu)
  ansible.builtin.debug:
    msg: "TODO: download from 'https://www.citrix.com/downloads/workspace-app/linux/'"
  when:
    - ansible_distribution == "Ubuntu"


# ### Archlinux/Manjaro: ins bootstrap-script aufenommen

# - name: TODO - Local packages install - Download and install Citrix Workspace App (icaclient) from AUR (Arch)
#  ansible.builtin.debug:
#    msg: "TODO: Install from AUR: 'sudo pamac build --no-confirm icaclient'"
#  when:
#    - ansible_distribution == "Archlinux"

# - name: Local packages install - Download and install Citrix Workspace App (icaclient) from AUR (Archlinux)
#  ansible.builtin.shell:
#    cmd: "sudo pamac build --no-confirm icaclient && touch /home/{{ env_user }}/.icaclientInstalled"
#  args:
#    creates: "/home/{{ env_user }}/.icaclientInstalled"
#  when:
#    - ansible_distribution == "Archlinux"


# ######################
# ### Visual Studio Code
# ######################

- name: Local packages install - get stat /usr/bin/code (all)
  ansible.builtin.stat:
    path: /usr/bin/code
  register: usrbincode
  # when:
    # - ansible_distribution == "Ubuntu"

- name: Local packages install - download Visual Studio Code deb-package (Ubuntu)
  ansible.builtin.get_url:
    url: "https://code.visualstudio.com/sha/download?build=stable&os=linux-deb-x64"
    dest: /tmp/code.deb
    # force_basic_auth: yes
    force: false
    mode: '0755'
  when:
    - ansible_distribution == "Ubuntu"
    - usrbincode.stat.exists == false

- name: Local packages install - install Visual Studio Code deb-package (Ubuntu, apt)
  tags: workstation,ubuntu,apt
  ansible.builtin.apt:
    deb: /tmp/code.deb
    only_upgrade: true
  when:
    - ansible_pkg_mgr == "apt"
    - ansible_distribution == "Ubuntu"
    - usrbincode.stat.exists == false
