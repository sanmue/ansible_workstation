# ##############
# ### SSH / SSHD
# ### ##########

- name: Services - start ssh (Ubuntu)
  ansible.builtin.service:
    name: ssh
    state: started
  when: ansible_distribution in ["Ubuntu"]

- name: Services - enable ssh (Ubuntu)
  ansible.builtin.service: 
    name: ssh
    enabled: true
  when: ansible_distribution in ["Ubuntu"]


- name: Services - start sshd (Archlinux)
  ansible.builtin.service:
    name: sshd
    state: started
  when: ansible_distribution in ["Archlinux"]

- name: Services - enable sshd (Archlinux)
  ansible.builtin.service:
    name: sshd
    enabled: true
  when: ansible_distribution in ["Archlinux"]


# ##########
# ### ClamAV
# ### ######

# Arch-Wiki/ManjaroWiki: https://wiki.archlinux.org/title/ClamAV bzw. https://wiki.manjaro.org/index.php/ClamAV
# You will need to run freshclam before starting the service for the first time 
# or you will run into trouble/errors which will prevent ClamAV from starting correctly.
#
# You may get a notification that clamd was not notified. This is normal because we haven't started the service yet.
#
- name: Update clamav database (Ubuntu, Arch)
  ansible.builtin.shell:
    cmd: freshclam && touch /home/{{ env_user }}/.freshclamInitialStartExecuted
  args:
    creates: /home/{{ env_user }}/.freshclamInitialStartExecuted
  when: ansible_distribution in ["Ubuntu", "Archlinux"]


- name: Services - Start clamav-daemon.service (Ubuntu, Arch)
  ansible.builtin.service:
    name: clamav-daemon.service
    state: started
  when: ansible_distribution in ["Ubuntu", "Archlinux"]

- name: Services - enable clamav-daemon.service (Ubuntu, Arch)
  ansible.builtin.service:
    name: clamav-daemon.service
    enabled: true
  when: ansible_distribution in ["Ubuntu", "Archlinux"]


- name: Services - Start clamav-freshclam.service (Ubuntu, Arch)
  ansible.builtin.service:
    name: clamav-freshclam.service
    state: started
  when: ansible_distribution in ["Ubuntu", "Archlinux"]

- name: Services - enable clamav-freshclam.service (Ubuntu, Arch)
  ansible.builtin.service:
    name: clamav-freshclam.service
    enabled: true
  when: ansible_distribution in ["Ubuntu", "Archlinux"]
