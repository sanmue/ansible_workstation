# ### https://wiki.archlinux.org/title/Postfix

- name: Config postfix - aliases (Archlinux, Ubuntu)
  ansible.builtin.replace:
    path: /etc/postfix/aliases
    regexp: '^#root.*you'
    replace: "root: {{ env_user }}"
  when:
    - ansible_distribution in ["Archlinux", "Ubuntu"]

- name: Config postfix - run postalias command (Archlinux, Ubuntu)
  ansible.builtin.shell:
    cmd: postalias /etc/postfix/aliases && newaliases
  when:
    - ansible_distribution in ["Archlinux", "Ubuntu"]


# ### config postfix for local mail:
- name: Config postfix - local mail - main.cf (Archlinux, Ubuntu)
  ansible.builtin.lineinfile:
    path: /etc/postfix/main.cf
    insertafter: '^#myhostname?=?virtual.domain.tld'
    line: myhostname = localhost
    state: present
  when:
    - ansible_distribution in ["Archlinux", "Ubuntu"]
