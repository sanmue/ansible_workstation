# - name: add ansible-pull cron job
#  tags: cron
#  cron:
#    name: ansible auto-provision
#    user: s_ansible
#    minute: "*/10"
#    job: ansible-pull -o -U https://github.com/sanmue/ansible_test.git


### ##############
### Pacman-Mirrors
### ##############
# nicht benötigt
# Für Manjaro: es gibt u.a. 'pamac-mirrorlist.timer', der wöchentlich auf die 8 schnellsten server aktualisiert
# bei Arch: 'reflector' nutzen
#- name: Create Cronjob to update pacman-mirrors (Archlinux)
#  ansible.builtin.cron:
#    name: "Update pacman-mirrors every month"
#    special_time: monthly
#    user: root
#    job: "pacman-mirrors -c all && pacman-mirrors --country Germany,France,Austria,Switzerland,Netherlands && pacman -Syyu"
#  when:
#    - ansible_distribution == "Archlinux"


### ######
### ClamAV
### ######

- name: Create Cronjob to update ClamAV database (Archlinux, Ubuntu)
  ansible.builtin.cron:
    name: "Update ClamAV database"
    special_time: hourly
    user: clamav
    job: "/usr/bin/freshclam --quiet"
  when:
    - ansible_distribution in ["Ubuntu", "Archlinux"]

- name: Create 'quarantine' and 'logs' folder for ClamAV for env_user (Archlinux, Ubuntu)
  ansible.builtin.file:
    path: "/home/{{ env_user }}/{{ item }}"
    state: directory
    owner: "{{ env_user }}"
    group: "{{ env_user }}"
    mode: '0755'
  loop:
    - .clam/logs
    - .clam/quarantine
  when:
    - ansible_distribution in ["Ubuntu", "Archlinux"]

- name: Create Cronjob to scan home-folder of env_user (Archlinux, Ubuntu)
  ansible.builtin.cron:
    name: "scan home-folder"
    special_time: weekly
    user: "{{ env_user }}"
    # job: /usr/bin/clamdscan --fdpass --multiscan --move="${HOME}/.clam/quarantine" --log="${HOME}/.clam/logs/$(date +\%Y\%m\%d)-weekly.log" "${HOME}" 2>/dev/null 1>&2
    job: '/etc/clamav/ScanHOME.sh "${HOME}" 2>/dev/null'
  when:
    - ansible_distribution in ["Ubuntu", "Archlinux"]


# ### ClamAV Settings (/etc/clamav/clamd.conf): siehe 'config_all-settings-misc.yml'
