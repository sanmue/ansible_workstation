
###################################
### NOT Desktop Environmet specific
###################################

- name: Install basic packages for workstations (all)
  tags: basic, workstation, ubuntu, arch
  package:
    state: latest
    name:
      - ansible   # bereits installiert (bootstrap)
      - ansible-lint   # für z.B. ansible extension in VS Code
      - clamav
      - clamtk
      - curl
      - deja-dup   # A trivial-to-use personal backup tool to protect against accidental data loss
      - dmidecode
      - evolution
      - evolution-bogofilter
      - evolution-ews   # MS Exchange integration through Exchange Web Services
      - evolution-spamassassin
      - flatpak
      - gimp
      - gimp-help-en
      - git   # bereits installiert (bootstrap)
      - grsync
      - gufw    # gui for ufw
      - hplip   # Drivers for HP DeskJet, OfficeJet, Photosmart, Business Inkjet and some LaserJet
      - htop
      - hunspell
      #- hyphen-de
      - inxi
      - kdeconnect
      - keepassxc
      - kitty   # gpu beschleunigtes terminal
      - lsb-release
      - make
      #- man-pages-de
      - neofetch
      - rsync   # bereits installiert (bootstrap)
      #- samba   # für VM: File sharing between host and Windows guest; https://wiki.manjaro.org/index.php/Virt-manager/en
      #- manjaro-settings-samba   # Adds an smb.conf file for Manjaro and enables samba
      - shellcheck
      #- skanlite   # bei KDE Plasma Desktop
      - steam
      - syncthing
      #- terminator   # Terminal emulator that supports tabs and grids
      - snapd
      - timeshift
      - vim   # bereits installiert (bootstrap)
      - vlc
      - unzip
      - wget
      - xdg-utils
      #
      # --- Firewall
      - ufw   # bereits installiert (bootstrap)
      #- firewalld   # ggf. ändern
      #
      # ---------
      # firmware:
      - b43-fwcutter
      - fwupd
      - linux-firmware


- name: check if btrfs filesystem + register result in variable (all)
  tags: basic, workstation
  ansible.builtin.command: mount | grep "^/dev" | grep "on / " | grep "btrfs"
  register: rootFsIsBtrfs
  ignore_errors: true

- name: install basic packages for snapper on btrfs filesystem (all)
  tags: basic, workstation
  package:
    state: latest
    name:
      ### for btrfs filesystem:
      - snapper           # A tool for managing BTRFS and LVM snapshots. It can create, diff and restore snapshots and provides timelined auto-snapping.
      - snapper-gui       # GUI for snapper, a tool for Linux filesystem snapshot management
      # >>> You must create a default config with snapper cli named root first.
      # >>> Run 'snapper -c root create-config /' as root
  #with_items: ansible_mounts
  when: 
    #- item.mount  == '/'
    #- item.fstype == 'btrfs'
    - rootFsIsBtrfs != ''

- name: check if default snapper config 'root' for '/' already exists (all)
  tags: basic, workstation
  ansible.builtin.command: snapper list-configs | grep root
  register: snapperDefaultConfigExists
  ignore_errors: true

- name: create a default config for '/' with snapper cli named 'root' (all)
  tags: basic, workstation
  ansible.builtin.shell: snapper -c root create-config / && touch /home/{{ env_user }}/.snapperDefaultRootConfigCreated
  #with_items: ansible_mounts
  args:
    creates: /home/{{ env_user }}/.snapperDefaultRootConfigCreated
  when: 
    #- item.mount  == '/'
    #- item.fstype == 'btrfs'
    - rootFsIsBtrfs != ''
    #- snapperDefaultConfigExists == ''
    #- snapperDefaultConfigExists is not defined or snapperDefaultConfigExists == ''

- name: install additional packages for snapper on btrfs filesystem (Archlinux)
  tags: basic, workstation, arch
  package:
    state: latest
    name:
      ### additional packages for btrfs filesystem:
      - btrfs-assistant   # An application for managing BTRFS subvolumes and Snapper snapshots
      - snap-pac          # Pacman hooks that use snapper to create pre/post btrfs snapshots like openSUSE's YaST
      - snap-sync         # Use snapper snapshots to backup to external drive
      - timeshift-autosnap-manjaro
  #with_items: ansible_mounts
  when: 
    #- item.mount  == '/'
    #- item.fstype == 'btrfs'
    - rootFsIsBtrfs != ''
    - ansible_distribution in ["Archlinux"]


- name: install basic packages (Archlinux)
  tags: basic, workstation, arch
  package:
    state: latest
    name:
      - archlinux-keyring
      - base-devel   # insbes. wg. AUR Paketen   # bereits installiert (bootstrap)
      - brave-browser
      - chromium
      - code   # The Open Source build of Visual Studio Code (vscode) editor
      - discord
      #- evolution-on   # Tray plugin for the Evolution email client
      #- exfat-utils   # exfat-utils and exfatprogs are in conflict
      - firefox
      - firefox-i18n-en-us
      #- flameshot   # -> ksnip
      - foliate
      - gnupg
      - gpgme
      - hunspell-de
      - hunspell-en_us
      # ipset
      - ksnip
      - libreoffice-still
      #- libreoffice-still-de
      - libreoffice-still-en-gb
      - linux-steam-integration
      - lshw
      - malcontent   # Parental control support for applications
      - manjaro-keyring
      - nextcloud-client
      - openssh   # bereits installiert (bootstrap)
      - psutils   # A set of postscript utilities
      - python-psutil
      - pyenv
      - remmina
      - signal-desktop
      - torbrowser-launcher
      - vim-ansible
      #
      # -----------------------------------
      # flatpak- und snap-plugin für pamac:
      - libpamac-flatpak-plugin
      - pamac-snap-plugin
      #
      # ---------
      # firmware:
      #- alsa-firmware   # unresolvable package conflicts detected
      - sof-firmware
  when: ansible_distribution in ["Archlinux"]


- name: install basic packages (Ubuntu)
  tags: basic, ubuntu, workstation
  package:
    state: latest
    name:
      - anki
      - clamav-daemon
      - evolution-plugin-pstimport
      - evolution-plugins
      - exfat-fuse#
      #- firefox # -> in Standard-Inst bereits vorhanden (ab 22.04: als snap package)
      #- firefox-locale-de
      #- firefox-locale-en
      - gitk
      - gpg
      - hunspell-de-de
      - hunspell-en-us
      - libidn11-dev   # benötigt für Citrix Workspace app (ica client)
      #- luckybackup
      - openssh-client
      - powershell   # repo wurde hinzugefügt
      - python3-psutil
      #- searchmonkey
      - ssh   # bereits installiert (bootstrap)
      - ufw   # bereits installiert (bootstrap)
      #
      # Multimedia; entspechend libs sollten bereits installiert sein (wenn mei Installer ausgewählt wurde)
      #- ffmpeg
      #- x264
      #- x265
      ##- gstreamer - kram
      #- ...
      #- youtube-dl
  when: ansible_distribution == "Ubuntu"


#- name: Install packages for workstations - Firefox from MozillaTeam ppa (Ubuntu >=22 + Gnome)
#  tags: workstation,gnome,ubuntu
#  ansible.builtin.apt:
#    state: latest
#    name:
##      - firefox              # ab Ubuntu 22.04: Standard als snap package installiert (Probleme: z.B. Keepassxc Erweiterung)
##      - firefox-dev
#      - firefox               # wenn alles korrekt vorher konfiguriert wurde, wird Firefox aus mozillateam ppa als deb-package installiert
##      - firefox-locale-de
#      - firefox-locale-en
##      - firefox-esr
##      - firefox-esr-locale-en      
#    default_release: 'o=LP-PPA-mozillateam'   # damit aus ppa installiert wird, und nicht wieder von ubuntu als snap
#    update_cache: yes
#  when:
#    - ansible_distribution == "Ubuntu"
#    - ansible_distribution_major_version|int >= 22
#    - env_desktop == "ubuntu:gnome"

### Visual Studio Code - Install
### - moved to ...-manualInstall.yml


- name: install basic packages - prereqesites for Pyenv (Ubuntu)
  tags: basic, ubuntu, workstation
  package:
    state: latest
    name:
#     Pyenv
#     https://ostechnix.com/pyenv-python-version-management-made-easier/
#     https://github.com/pyenv/pyenv-installer
#
#     manche Pakete sind schon installiert (s.o.)
      - make
      - build-essential
      - libssl-dev
      - zlib1g-dev
      - libbz2-dev
      - libreadline-dev
      - libsqlite3-dev
      - wget
      - curl
      - llvm
      - libncurses5-dev
      - libncursesw5-dev
      - xz-utils
      - tk-dev
  when: ansible_distribution == "Ubuntu"

- name: install basic packages - Download Installer-Skript for Pyenv (Ubuntu)
  tags: basic, ubuntu, workstation
  ansible.builtin.get_url:
    url: https://github.com/pyenv/pyenv-installer/raw/master/bin/pyenv-installer
    dest: /tmp/pyenv-installer.sh
    mode: u=rwx,g=rwx,o=rwx
  when: ansible_distribution == "Ubuntu"

- name: install basic packages - Execute Installer-Skript for Pyenv (Ubuntu)
  tags: basic, ubuntu, workstation
  ansible.builtin.script:
    cmd: /tmp/pyenv-installer.sh
  args:
    creates: /home/{{ env_user }}/.pyenv   # Run only if '.pyenv'-directory does not alrady exist (from previous run)
  become: true
  become_user: "{{ env_user }}"
  when: ansible_distribution == "Ubuntu"


- name: install basic packages (all + x11 display server)
  tags: basic, ubuntu, arch, workstation
  package:
    state: latest
    name:
      - xclip   # Command line interface to the X11 clipboard   # Voraussetzung für snap-package "espanso"
  when:
    - ansible_distribution in ["Ubuntu", "Archlinux"]
    - env_displayserver == "x11"



#- name: install Vivaldi Browser (Ubuntu)
#  tags: workstation,ubuntu,suse
#  package:
#    state: latest
#    name:
#      - vivaldi-stable
##  when: ansible_os_family == "Suse" or
##        ansible_distribution in ["Ubuntu"]
#  when: ansible_distribution in ["Ubuntu"]

#- name: install Vivaldi Browser (Archlinux)
#  tags: workstation,arch
#  package:
#    state: latest
#    name:
#      - vivaldi
#      - vivaldi-ffmpeg-codecs
#  when:
#    - ansible_distribution in ["Archlinux"]
