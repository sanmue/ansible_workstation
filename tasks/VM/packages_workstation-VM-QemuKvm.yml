
# TODO: ggf. noch nested virtualization


- name: install VM QEMU/KVM (Ubuntu)
  tags: VM
  package:
    state: latest
    name:
      - qemu-kvm
      - libvirt-daemon-system
      - libvirt-clients
      - bridge-utils
      - libguestfs-tools
      - libosinfo-bin
      - virtinst
      - virt-top
      - swtpm        # wg. Win11: TPM 2.0;
      - swtpm-tools  # zumin. bis Ubuntu < 22 ist ppa erforderlich (ppa:smoser/swtpm)
  when:
    - ansible_distribution == "Ubuntu"
    - ansible_virtualization_role != "guest"
# noch ohne nested virtualization


- name: install VM QEMU/KVM (Archlinux)
  tags: VM
  package:
    state: latest
    name:
#     for check:
      - dmidecode
      - inxi
#     qemu, dependendies, ...:
      - bridge-utils
      - dnsmasq
      - ebtables
      - edk2-ovmf # UEFI Support
      - libvirt
      - openbsd-netcat
      - qemu
      - samba
      - vde2
      - virt-install
  when:
    - ansible_distribution == "Archlinux"
    - ansible_virtualization_role != "guest"
# noch ohne nested virtualization


- name: install VM QEMU/KVM - virt-manager/viewer (Workstation, all distros with DesktopEnv)
  tags: VM,workstation
  package:
    state: latest
    name:
      - virt-manager
      - virt-viewer
  when: ansible_virtualization_role != "guest"
