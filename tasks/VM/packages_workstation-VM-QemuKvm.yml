
# TODO: ggf. noch nested virtualization

- name: install VM QEMU/KVM (Ubuntu, not VM guest)
  tags: VM
  package:
    state: latest
    name:
      - qemu-kvm
      - libvirt-daemon-system
      - libvirt-clients
      - bridge-utils
      - libguestfs-tools
      - libosinfo-bin
      - virtinst
      - virt-top
      - swtpm        # wg. Win11: TPM 2.0;
      - swtpm-tools  # zumin. bis Ubuntu < 22 ist ppa erforderlich (ppa:smoser/swtpm)
  when:
    - ansible_distribution == "Ubuntu"
    - ansible_virtualization_role != "guest"


- name: install VM QEMU/KVM (Archlinux, not VM guest)
  tags: VM
  package:
    state: latest
    name:
      - bridge-utils      # Utilities for configuring the Linux ethernet bridge
      - dnsmasq           # Lightweight, easy to configure DNS forwarder and DHCP server
      - iptables-nft      # conflicts with 'iptables' (installiert, wird über bootstrap.sh geändert und auch schon installiert)
                          # Linux kernel packet control tool (using nft interface)
      - edk2-ovmf         # UEFI Support # Firmware for Virtual Machines
      - libguestfs        # Access and modify virtual machine disk images
      - libvirt           # # API for controlling virtualization engines (openvz,kvm,qemu,virtualbox,xen,etc)
      #- community/libvirt # wenn - libvirt' nicht eindeutig
      - openbsd-netcat    # TCP/IP swiss army knife. OpenBSD variant. # network piping application
      #- qemu              # hier muss aus 3 Optionen ausgewählt werden (base, desktop, full)
      #- qemu-base         # A basic QEMU setup for headless environments
      - qemu-desktop      # A QEMU setup for desktop environments
      #- qemu-full         # A Full QEMU setup
      - swtpm             # Libtpms-based TPM emulator with socket, character device, and Linux CUSE interface
      - vde2              # Virtual Distributed Ethernet for emulators like qemu
      - virt-install      # Command line tool for creating new KVM , Xen, or Linux container guests using the libvirt hypervisor
  when:
    - ansible_distribution == "Archlinux"
    - ansible_virtualization_role != "guest"


- name: install VM QEMU/KVM - virt-manager/viewer (all, not VM guest)
  tags: VM,workstation
  package:
    state: latest
    name:
      - virt-manager
      - virt-viewer
  when: ansible_virtualization_role != "guest"
